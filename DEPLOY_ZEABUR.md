# Инструкция по обновлению деплоя на Zeabur

## Проблема
После добавления Core Betting Engine, сервер на Zeabur ещё не обновился и работает со старой версией кода.

## Решение

### Вариант 1: Автоматическое обновление (рекомендуется)

Zeabur должен автоматически обновить деплой после git push. Проверьте:

1. Зайдите в панель Zeabur: https://dash.zeabur.com
2. Выберите ваш проект: `qwesadasdqw`
3. Перейдите во вкладку **Deployments**
4. Если видите статус **Building** — дождитесь завершения
5. Если **Failed** — проверьте логи ошибок

### Вариант 2: Ручной триггер деплоя

Если автоматическое обновление не сработало:

1. В панели Zeabur найдите кнопку **Redeploy** или **Deploy Now**
2. Нажмите для принудительного обновления

### Вариант 3: Через переменные окружения

Иногда помогает изменение переменной окружения:

1. В панели Zeabur перейдите в **Variables**
2. Добавьте или измените любую переменную (например `DEPLOY_VERSION=2`)
3. Сохраните — это триггернет пересборку

## Проверка после обновления

После обновления проверьте работу новых endpoints:

```bash
# Проверка Swagger документации
https://qwesadasdqw.zeabur.app/docs

# Проверка betting endpoints
https://qwesadasdqw.zeabur.app/api/betting/my-bets

# Health check
https://qwesadasdqw.zeabur.app/health
```

## Возможные ошибки и решения

### Ошибка: ModuleNotFoundError: No module named 'betting_routes'

**Причина:** Zeabur не видит новые файлы

**Решение:**
1. Убедитесь что все файлы закоммичены и запушены
2. Проверьте что Dockerfile копирует всю папку api:
   ```dockerfile
   COPY api /app/api
   ```

### Ошибка: ImportError при старте

**Причина:** Missing зависимости

**Решение:**
1. Проверьте что `apscheduler` есть в requirements.txt
2. Все зависимости уже должны быть в `api/requirements.txt`

### Ошибка: PORT не настроен

**Причина:** Zeabur использует другой порт

**Решение:**
1. В панели Zeabur проверьте переменную `PORT`
2. Должно быть `8000` или `8080`
3. В Dockerfile PORT должен совпадать

## Телеграм бот токен

Для работы аутентификации через Telegram:

1. В панели Zeabur добавьте переменную:
   ```
   TELEGRAM_BOT_TOKEN=ваш_токен_от_BotFather
   ```

2. Без этого токена endpoints будут возвращать ошибку аутентификации

## Проверка логов

Для отладки:

1. В панели Zeabur → **Logs**
2. Ищите ошибки при старте:
   - `ImportError`
   - `ModuleNotFoundError`
   - `OperationalError` (проблемы с БД)

##成功后确认清单

- [ ] Деплой успешно завершён (статус **Ready**)
- [ ] `/docs` открывает Swagger UI
- [ ] `/api/betting/my-bets` возвращает JSON (не HTML)
- [ ] `/health` показывает статус синхронизации
- [ ] В логах нет ошибок
